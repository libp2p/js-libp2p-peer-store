<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@libp2p/peer-store - v6.0.0</title><meta name="description" content="Documentation for @libp2p/peer-store - v6.0.0"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@libp2p/peer-store - v6.0.0</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>@libp2p/peer-store - v6.0.0</h2></div>
<div class="tsd-panel tsd-typography">
<a href="#libp2ppeer-store-" id="libp2ppeer-store-" style="color: inherit; text-decoration: none;">
  <h1>@libp2p/peer-store <!-- omit in toc --></h1>
</a>
<p><a href="http://libp2p.io/"><img src="https://img.shields.io/badge/project-libp2p-yellow.svg?style=flat-square" alt="libp2p.io"></a>
<a href="https://discuss.libp2p.io"><img src="https://img.shields.io/discourse/https/discuss.libp2p.io/posts.svg?style=flat-square" alt="Discuss"></a>
<a href="https://codecov.io/gh/libp2p/js-libp2p-peer-store"><img src="https://img.shields.io/codecov/c/github/libp2p/js-libp2p-peer-store.svg?style=flat-square" alt="codecov"></a>
<a href="https://github.com/libp2p/js-libp2p-peer-store/actions/workflows/js-test-and-release.yml?query=branch%3Amaster"><img src="https://img.shields.io/github/actions/workflow/status/libp2p/js-libp2p-peer-store/js-test-and-release.yml?branch=master&style=flat-square" alt="CI"></a></p>
<blockquote>
<p>Stores information about peers libp2p knows on the network</p>
</blockquote>

<a href="#table-of-contents-" id="table-of-contents-" style="color: inherit; text-decoration: none;">
  <h2>Table of contents <!-- omit in toc --></h2>
</a>
<ul>
<li><a href="#install">Install</a><ul>
<li><a href="#browser-script-tag">Browser <code>&lt;script&gt;</code> tag</a></li>
</ul>
</li>
<li><a href="#description">Description</a><ul>
<li><a href="#submitting-records-to-the-peerstore">Submitting records to the PeerStore</a><ul>
<li><a href="#identify">Identify</a></li>
<li><a href="#peer-discovery">Peer Discovery</a></li>
<li><a href="#dialer">Dialer</a></li>
<li><a href="#dht">DHT</a></li>
</ul>
</li>
<li><a href="#retrieving-records-from-the-peerstore">Retrieving records from the PeerStore</a><ul>
<li><a href="#peer">Peer</a></li>
<li><a href="#protocols">Protocols</a></li>
<li><a href="#multiaddrs">Multiaddrs</a></li>
</ul>
</li>
<li><a href="#peerstore-implementation">PeerStore implementation</a></li>
<li><a href="#components">Components</a><ul>
<li><a href="#address-book">Address Book</a></li>
<li><a href="#key-book">Key Book</a></li>
<li><a href="#protocol-book">Protocol Book</a></li>
<li><a href="#metadata-book">Metadata Book</a></li>
</ul>
</li>
<li><a href="#api">API</a></li>
<li><a href="#events">Events</a></li>
</ul>
</li>
<li><a href="#data-persistence">Data Persistence</a></li>
<li><a href="#future-considerations">Future Considerations</a></li>
<li><a href="#api-docs">API Docs</a></li>
<li><a href="#license">License</a></li>
<li><a href="#contribution">Contribution</a></li>
</ul>

<a href="#install" id="install" style="color: inherit; text-decoration: none;">
  <h2>Install</h2>
</a>
<pre><code class="language-console"><span class="hl-0">$ </span><span class="hl-1">npm</span><span class="hl-0"> </span><span class="hl-1">i</span><span class="hl-0"> </span><span class="hl-1">@libp2p/peer-store</span>
</code></pre>

<a href="#browser-ltscriptgt-tag" id="browser-ltscriptgt-tag" style="color: inherit; text-decoration: none;">
  <h3>Browser <code>&lt;script&gt;</code> tag</h3>
</a>
<p>Loading this module through a script tag will make it&#39;s exports available as <code>Libp2pPeerStore</code> in the global namespace.</p>
<pre><code class="language-html"><span class="hl-2">&lt;</span><span class="hl-3">script</span><span class="hl-4"> </span><span class="hl-5">src</span><span class="hl-4">=</span><span class="hl-6">&quot;https://unpkg.com/@libp2p/peer-store/dist/index.min.js&quot;</span><span class="hl-2">&gt;&lt;/</span><span class="hl-3">script</span><span class="hl-2">&gt;</span>
</code></pre>

<a href="#description" id="description" style="color: inherit; text-decoration: none;">
  <h2>Description</h2>
</a>
<p>Libp2p&#39;s PeerStore is responsible for keeping an updated register with the relevant information of the known peers. It should be the single source of truth for all peer data, where a subsystem can learn about peers&#39; data and where someone can listen for updates. The PeerStore comprises four main components: <code>addressBook</code>, <code>keyBook</code>, <code>protocolBook</code> and <code>metadataBook</code>.</p>
<p>The PeerStore manages the high level operations on its inner books. Moreover, the PeerStore should be responsible for notifying interested parties of relevant events, through its Event Emitter.</p>

<a href="#submitting-records-to-the-peerstore" id="submitting-records-to-the-peerstore" style="color: inherit; text-decoration: none;">
  <h3>Submitting records to the PeerStore</h3>
</a>
<p>Several libp2p subsystems will perform operations that might gather relevant information about peers.</p>

<a href="#identify" id="identify" style="color: inherit; text-decoration: none;">
  <h4>Identify</h4>
</a>
<ul>
<li>The Identify protocol automatically runs on every connection when multiplexing is enabled. The protocol will put the multiaddrs and protocols provided by the peer to the PeerStore.</li>
<li>In the background, the Identify Service is also waiting for protocol change notifications of peers via the IdentifyPush protocol. Peers may leverage the <code>identify-push</code> message to communicate protocol changes to all connected peers, so that their PeerStore can be updated with the updated protocols.</li>
<li>While it is currently not supported in js-libp2p, future iterations may also support the <a href="https://github.com/libp2p/specs/pull/176">IdentifyDelta protocol</a>.</li>
<li>Taking into account that the Identify protocol records are directly from the peer, they should be considered the source of truth and weighted accordingly.</li>
</ul>

<a href="#peer-discovery" id="peer-discovery" style="color: inherit; text-decoration: none;">
  <h4>Peer Discovery</h4>
</a>
<ul>
<li>Libp2p discovery protocols aim to discover new peers in the network. In a typical discovery protocol, addresses of the peer are discovered along with its peer id. Once this happens, a libp2p discovery protocol should emit a <code>peer</code> event with the information of the discovered peer and this information will be added to the PeerStore by libp2p.</li>
</ul>

<a href="#dialer" id="dialer" style="color: inherit; text-decoration: none;">
  <h4>Dialer</h4>
</a>
<ul>
<li>Libp2p API supports dialing a peer given a <code>multiaddr</code>, and no prior knowledge of the peer. If the node is able to establish a connection with the peer, it and its multiaddr is added to the PeerStore.</li>
<li>When a connection is being upgraded, more precisely after its encryption, or even in a discovery protocol, a libp2p node can get to know other parties public keys. In this scenario, libp2p will add the peer&#39;s public key to its <code>KeyBook</code>.</li>
</ul>

<a href="#dht" id="dht" style="color: inherit; text-decoration: none;">
  <h4>DHT</h4>
</a>
<ul>
<li>On some DHT operations, such as finding providers for a given CID, nodes may exchange peer data as part of the query. This passive peer discovery should result in the DHT emitting the <code>peer</code> event in the same way <a href="#peerdiscovery">Peer Discovery</a> does.</li>
</ul>

<a href="#retrieving-records-from-the-peerstore" id="retrieving-records-from-the-peerstore" style="color: inherit; text-decoration: none;">
  <h3>Retrieving records from the PeerStore</h3>
</a>
<p>When data in the PeerStore is updated the PeerStore will emit events based on the changes, to allow applications and other subsystems to take action on those changes. Any subsystem interested in these notifications should subscribe the <a href="%5Bhttps://github.com/libp2p/js-libp2p/blob/master/doc/API.md#libp2ppeerStore%5D"><code>PeerStore events</code></a>.</p>

<a href="#peer" id="peer" style="color: inherit; text-decoration: none;">
  <h4>Peer</h4>
</a>
<ul>
<li>Each time a new peer is discovered, the PeerStore should emit a <a href="%5Bhttps://github.com/libp2p/js-libp2p/blob/master/doc/API.md#libp2ppeerStore%5D"><code>peer</code> event</a>, so that interested parties can leverage this peer and establish a connection with it.</li>
</ul>

<a href="#protocols" id="protocols" style="color: inherit; text-decoration: none;">
  <h4>Protocols</h4>
</a>
<ul>
<li>When the known protocols of a peer change, the PeerStore emits a <a href="%5Bhttps://github.com/libp2p/js-libp2p/blob/master/doc/API.md#libp2ppeerStore%5D"><code>change:protocols</code> event</a>.</li>
</ul>

<a href="#multiaddrs" id="multiaddrs" style="color: inherit; text-decoration: none;">
  <h4>Multiaddrs</h4>
</a>
<ul>
<li>When the known listening <code>multiaddrs</code> of a peer change, the PeerStore emits a <a href="%5Bhttps://github.com/libp2p/js-libp2p/blob/master/doc/API.md#libp2ppeerStore%5D"><code>change:multiaddrs</code> event</a>.</li>
</ul>

<a href="#peerstore-implementation" id="peerstore-implementation" style="color: inherit; text-decoration: none;">
  <h3>PeerStore implementation</h3>
</a>
<p>The PeerStore wraps four main components: <code>addressBook</code>, <code>keyBook</code>, <code>protocolBook</code> and <code>metadataBook</code>. Moreover, it provides a high level API for those components, as well as data events.</p>

<a href="#components" id="components" style="color: inherit; text-decoration: none;">
  <h3>Components</h3>
</a>

<a href="#address-book" id="address-book" style="color: inherit; text-decoration: none;">
  <h4>Address Book</h4>
</a>
<p>The <code>addressBook</code> keeps the known multiaddrs of a peer. The multiaddrs of each peer may change over time and the Address Book must account for this.</p>
<p><code>Map&lt;string, Address&gt;</code></p>
<p>A <code>peerId.toString()</code> identifier mapping to a <code>Address</code> object, which should have the following structure:</p>
<pre><code class="language-js"><span class="hl-0">{</span><br/><span class="hl-0">  </span><span class="hl-7">multiaddr</span><span class="hl-0">: </span><span class="hl-2">&lt;</span><span class="hl-8">Multiaddr</span><span class="hl-2">&gt;</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#key-book" id="key-book" style="color: inherit; text-decoration: none;">
  <h4>Key Book</h4>
</a>
<p>The <code>keyBook</code> tracks the public keys of the peers by keeping their <a href="https://github.com/libp2p/js-peer-id"><code>PeerId</code></a>.</p>
<p><code>Map&lt;string, PeerId</code></p>
<p>A <code>peerId.toString()</code> identifier mapping to a <code>PeerId</code> of the peer. This instance contains the peer public key.</p>

<a href="#protocol-book" id="protocol-book" style="color: inherit; text-decoration: none;">
  <h4>Protocol Book</h4>
</a>
<p>The <code>protoBook</code> holds the identifiers of the protocols supported by each peer. The protocols supported by each peer are dynamic and will change over time.</p>
<p><code>Map&lt;string, Set&lt;string&gt;&gt;</code></p>
<p>A <code>peerId.toString()</code> identifier mapping to a <code>Set</code> of protocol identifier strings.</p>

<a href="#metadata-book" id="metadata-book" style="color: inherit; text-decoration: none;">
  <h4>Metadata Book</h4>
</a>
<p>The <code>metadataBook</code> keeps track of the known metadata of a peer. Its metadata is stored in a key value fashion, where a key identifier (<code>string</code>) represents a metadata value (<code>Uint8Array</code>).</p>
<p><code>Map&lt;string, Map&lt;string, Uint8Array&gt;&gt;</code></p>
<p>A <code>peerId.toString()</code> identifier mapping to the peer metadata Map.</p>

<a href="#api" id="api" style="color: inherit; text-decoration: none;">
  <h3>API</h3>
</a>
<p>For the complete API documentation, you should check the <a href="../../doc/API.md">API.md</a>.</p>
<p>Access to its underlying books:</p>
<ul>
<li><code>peerStore.addressBook.*</code></li>
<li><code>peerStore.keyBook.*</code></li>
<li><code>peerStore.metadataBook.*</code></li>
<li><code>peerStore.protoBook.*</code></li>
</ul>

<a href="#events" id="events" style="color: inherit; text-decoration: none;">
  <h3>Events</h3>
</a>
<ul>
<li><code>peer</code> - emitted when a new peer is added.</li>
<li><code>change:multiaddrs</code> - emitted when a known peer has a different set of multiaddrs.</li>
<li><code>change:protocols</code> - emitted when a known peer supports a different set of protocols.</li>
<li><code>change:pubkey</code> - emitted when a peer&#39;s public key is known.</li>
<li><code>change:metadata</code> - emitted when known metadata of a peer changes.</li>
</ul>

<a href="#data-persistence" id="data-persistence" style="color: inherit; text-decoration: none;">
  <h2>Data Persistence</h2>
</a>
<p>The data stored in the PeerStore can be persisted if configured appropriately. Keeping a record of the peers already discovered by the peer, as well as their known data aims to improve the efficiency of peers joining the network after being offline.</p>
<p>The libp2p node will need to receive a <a href="https://github.com/ipfs/interface-datastore">datastore</a>, in order to persist this data across restarts. A <a href="https://github.com/ipfs/interface-datastore">datastore</a> stores its data in a key-value fashion. As a result, we need coherent keys so that we do not overwrite data.</p>
<p>The PeerStore should not continuously update the datastore whenever data is changed. Instead, it should only store new data after reaching a certain threshold of &quot;dirty&quot; peers, as well as when the node is stopped, in order to batch writes to the datastore.</p>
<p>The peer id will be appended to the datastore key for each data namespace. The namespaces were defined as follows:</p>
<p><strong>AddressBook</strong></p>
<p>All the known peer addresses are stored with a key pattern as follows:</p>
<p><code>/peers/addrs/&lt;b32 peer id no padding&gt;</code></p>
<p><strong>ProtoBook</strong></p>
<p>All the known peer protocols are stored with a key pattern as follows:</p>
<p><code>/peers/protos/&lt;b32 peer id no padding&gt;</code></p>
<p><strong>KeyBook</strong></p>
<p>All public keys are stored under the following pattern:</p>
<p><code> /peers/keys/&lt;b32 peer id no padding&gt;</code></p>
<p><strong>MetadataBook</strong></p>
<p>Metadata is stored under the following key pattern:</p>
<p><code>/peers/metadata/&lt;b32 peer id no padding&gt;/&lt;key&gt;</code></p>

<a href="#future-considerations" id="future-considerations" style="color: inherit; text-decoration: none;">
  <h2>Future Considerations</h2>
</a>
<ul>
<li>If multiaddr TTLs are added, the PeerStore may schedule jobs to delete all addresses that exceed the TTL to prevent AddressBook bloating</li>
<li>Further API methods will probably need to be added in the context of multiaddr validity and confidence.</li>
<li>When improving libp2p configuration for specific runtimes, we should take into account the PeerStore recommended datastore.</li>
<li>When improving libp2p configuration, we should think about a possible way of allowing the configuration of Bootstrap to be influenced by the persisted peers, as a way to decrease the load on Bootstrap nodes.</li>
</ul>

<a href="#api-docs" id="api-docs" style="color: inherit; text-decoration: none;">
  <h2>API Docs</h2>
</a>
<ul>
<li><a href="https://libp2p.github.io/js-libp2p-peer-store">https://libp2p.github.io/js-libp2p-peer-store</a></li>
</ul>

<a href="#license" id="license" style="color: inherit; text-decoration: none;">
  <h2>License</h2>
</a>
<p>Licensed under either of</p>
<ul>
<li>Apache 2.0, (<a href="LICENSE-APACHE">LICENSE-APACHE</a> / <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>)</li>
<li>MIT (<a href="LICENSE-MIT">LICENSE-MIT</a> / <a href="http://opensource.org/licenses/MIT">http://opensource.org/licenses/MIT</a>)</li>
</ul>

<a href="#contribution" id="contribution" style="color: inherit; text-decoration: none;">
  <h2>Contribution</h2>
</a>
<p>Unless you explicitly state otherwise, any contribution intentionally submitted for inclusion in the work by you, as defined in the Apache-2.0 license, shall be dual licensed as above, without any additional terms or conditions.</p>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">@libp2p/peer-<wbr/>store -<wbr/> v6.0.0</a>
<ul>
<li class="tsd-kind-module"><a href="modules/_internal_.html">&lt;internal&gt;</a></li></ul></li></ul></div></details></nav></div></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>